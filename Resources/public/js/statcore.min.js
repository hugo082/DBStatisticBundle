function ActionController(t,i,a,e){this.actions=i;this.graphController=t;this.container=$("<div>").attr({class:"actions-container"}).prependTo(e);this.graph=a;this.insert=function(){var t=this;this.actions.forEach(function(i){if(i.type==="button")t.insertButton(i);else t.insertSelect(i)})};this.insertButton=function(i){$("<button>").text(i.title).prependTo(this.container).data("id",this.graph.informations.id).data("action",i).click(function(){var i=$(this).data();t.update(i.action)})};this.insertSelect=function(t){var i=this.graphController;var a=$("<select>").text(t.title).prependTo(this.container).data("id",this.graph.informations.id).data("action",t).change(function(){t.value=$(this).val();i.update(t)});t.choices.forEach(function(t){a.append($("<option>",{value:t.id,text:t.title}))})}}function GraphController(t){this.chart=null;this.graph=null;this.id=t;this.elementId=null;this.container=function(){return $("div[data-id='"+this.id+"']")};this.actionController=new ActionController(this,null,null,this.container());this.request=function(){var t=this;$.ajax({url:"/statistic/data/"+this.id,data:null,success:function(i){t.loadResponse(i)}})};this.loadResponse=function(t){this.id=t.status.graph_id;if(t.status.code===200)this.load(t.graph);else{this.container().append("<h3 class='graph-error graph-error-title'>Error Loading Graph</h3>");this.container().append("<p class='graph-error graph-error-desc'>"+t.status.title+"</p>");console.error(t.status.message)}};this.load=function(t){this.graph=t;this.id=t.informations.id;this.elementId="elm_"+t.informations.id;$("<canvas>").attr({id:this.elementId}).appendTo(this.container());this.show();$("<div>").text(t.informations.title).attr({class:"title-container"}).prependTo(this.container());this.actionController.graph=this.graph;this.actionController.actions=t.actions;this.actionController.insert()};this.show=function(){this.chart=new Chart(this.elementId,{type:this.graph.informations.type,data:this.graph.data,options:this.graph.options})};this.update=function(t){var i={id:t.id,value:t.value};var a=this;$.ajax({url:"/statistic/data/"+a.id,data:i,success:function(t){if(typeof a.chart==="undefined"){console.error("Impossible to find chart with id : "+a.id);return}if(t.status.code===200){a.chart.data.labels=t.graph.data.labels;a.chart.data.datasets=t.graph.data.datasets;a.chart.update()}else console.error(t.status.message)}})}}var graphs=$("div[data-type='graph']");var multiple={};graphs.each(function(t){var i=$(this).data("multiple");if(typeof i!=="undefined"){if(typeof multiple[i]==="undefined")multiple[i]={};multiple[$(this).data("multiple")]["id"+t]=$(this).data("id")}else{var a=new GraphController($(this).data("id"));a.request()}});for(var graphSet in multiple){$.ajax({url:"/statistic/data/multiple",data:multiple[graphSet],success:function(t){for(var i in t.graphs){if(t.graphs.hasOwnProperty(i)){var a;a=new GraphController(null);a.loadResponse(t.graphs[i])}}}})}